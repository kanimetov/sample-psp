# –°—Ç–∞—Ç—É—Å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ PSP Service

## –û–±–∑–æ—Ä

PSP Service –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Å—Ç–∞–¥–∏–∏ MVP (Minimum Viable Product) —Å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–º–∏ –≤—Ö–æ–¥—è—â–∏–º–∏ API –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –æ—Ç –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞.

## ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### API Layer
- **IncomingController** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Ö–æ–¥—è—â–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –æ—Ç –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞
  - `POST /in/qr/{version}/tx/check` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
  - `POST /in/qr/{version}/tx/create` - —Å–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏  
  - `POST /in/qr/{version}/tx/execute/{transactionId}` - –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
  - `POST /in/qr/{version}/tx/update/{transactionId}` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞

### Security
- **SignatureService** - –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è JWS v2 –ø–æ–¥–ø–∏—Å–µ–π
- **SignatureInterceptor** - –ø–µ—Ä–µ—Ö–≤–∞—Ç –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–µ–π
- **KeyManagementService** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª—é—á–∞–º–∏ –ø–æ–¥–ø–∏—Å–∏

### Business Logic
- **IncomingService** - –æ—Å–Ω–æ–≤–Ω–∞—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
- **ValidationUtil** - –≤–∞–ª–∏–¥–∞—Ü–∏—è DTO –æ–±—ä–µ–∫—Ç–æ–≤
- **JsonUtil** - —Ä–∞–±–æ—Ç–∞ —Å JSON

### Data Layer
- **Entity –º–æ–¥–µ–ª–∏**:
  - `TransactionEntity` - –æ—Å–Ω–æ–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
  - `CheckRequestEntity` - —Ç–∞–±–ª–∏—Ü–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É
  - `ExtraDataEntity` - –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è key-value –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
- **Oracle —Å—Ö–µ–º–∞** - –ø–æ–ª–Ω–∞—è —Å—Ö–µ–º–∞ –ë–î —Å –∏–Ω–¥–µ–∫—Å–∞–º–∏ –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏

### Error Handling
- **GlobalExceptionHandler** - —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π
- **–°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è** - –¥–ª—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ç–∏–ø–æ–≤ –æ—à–∏–±–æ–∫
- **–°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ ErrorResponseDto** - –µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –æ–± –æ—à–∏–±–∫–∞—Ö

### Logging & Monitoring
- **LoggingUtil** - —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- **LoggingFilter** - —Ñ–∏–ª—å—Ç—Ä –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è HTTP –∑–∞–ø—Ä–æ—Å–æ–≤
- **–î–µ—Ç–∞–ª—å–Ω–æ–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ** - –æ–ø–µ—Ä–∞—Ü–∏–π, –ø–æ–¥–ø–∏—Å–µ–π, –æ—à–∏–±–æ–∫

## üîÑ –ü–ª–∞–Ω–∏—Ä—É–µ–º—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### API Layer
- **–í–Ω–µ—à–Ω–∏–µ API** - —Ñ–∞—Å–∞–¥ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤ (`/api/qr/tx/*`)
- **OperatorClient** - –∫–ª–∏–µ–Ω—Ç –¥–ª—è –∏—Å—Ö–æ–¥—è—â–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –æ–ø–µ—Ä–∞—Ç–æ—Ä—É

### Infrastructure
- **Redis** - –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å
- **RabbitMQ** - –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏ DLQ
- **Outbox pattern** - –Ω–∞–¥–µ–∂–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ —Å–æ–±—ã—Ç–∏–π

### Advanced Features
- **Rate limiting** - –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —á–∞—Å—Ç–æ—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤
- **Circuit breaker** - –∑–∞—â–∏—Ç–∞ –æ—Ç –∫–∞—Å–∫–∞–¥–Ω—ã—Ö —Å–±–æ–µ–≤
- **Retry mechanisms** - –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π

## üìä –¢–µ–∫—É—â–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
1. **Check** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
2. **Create** - —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
3. **Execute** - –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
4. **Update** - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

### –¢–∏–ø—ã —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- C2C, C2B, C2G, B2C, B2B, BANK_RESERVE, B2G

### –°—Ç–∞—Ç—É—Å—ã —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- CREATED (10), IN_PROCESS (20), ERROR (30), CANCELED (40), SUCCESS (50)

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤–Ω–µ—à–Ω–∏—Ö API** - –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤
2. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Redis** - –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å
3. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ RabbitMQ** - –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
4. **OperatorClient** - –∏—Å—Ö–æ–¥—è—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã –∫ –æ–ø–µ—Ä–∞—Ç–æ—Ä—É
5. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** - unit, integration, contract —Ç–µ—Å—Ç—ã
6. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** - –º–µ—Ç—Ä–∏–∫–∏, –∞–ª–µ—Ä—Ç—ã, –¥–∞—à–±–æ—Ä–¥—ã

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –í—Å–µ –≤—Ö–æ–¥—è—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã —Ç—Ä–µ–±—É—é—Ç JWS v2 –ø–æ–¥–ø–∏—Å–∏
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ API —á–µ—Ä–µ–∑ path parameter
- –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- –ü–æ–ª–Ω–∞—è —Å—Ö–µ–º–∞ –ë–î —Å –∏–Ω–¥–µ–∫—Å–∞–º–∏ –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏
